<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookNow - ƒê√°nh gi√°</title>
    <link rel="stylesheet" href="css/danhgia.css" />
  </head>
  <body>
    <!-- ================= Header ================= -->
    <header>
      <a href="business.html" class="logo">BookNow</a>
      <nav>
        <ul>
          <li><a href="dichvu.html">Qu·∫£n l√Ω d·ªãch v·ª•</a></li>
          <li><a href="doanhthu.html">Doanh thu</a></li>
          <li><a href="#">ƒê√°nh gi√°</a></li>
        </ul>
      </nav>
      <div class="auth-btns">
        <span class="welcome-text">xin ch√†o .doanh nghi·ªáp</span>
        <a href="dangnhap.html" class="login-btn">ƒêƒÉng xu·∫•t</a>
      </div>
    </header>

    <!-- ================= Banner ================= -->
    <section class="banner">
      <div class="banner-content">
        <h1>ƒê√°nh gi√°</h1>
        <p>Qu·∫£n l√Ω ƒë√°nh gi√° t·ª´ kh√°ch h√†ng</p>
      </div>
    </section>

    <!-- Main content: Feedback list -->
    <main
      class="container"
      style="
        padding: 40px 100px;
        margin: 40px auto;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.16);
      "
    >
      <section
        id="reviews"
        style="width: 100%; max-width: 1200px; margin: 0 auto"
      >
        <h2 style="color: #004b9a; margin-bottom: 12px">Qu·∫£n l√Ω ƒë√°nh gi√°</h2>

        <div
          style="
            margin-bottom: 18px;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
          "
        >
          <label for="filterStatus">L·ªçc tr·∫°ng th√°i:</label>
          <select id="filterStatus" style="padding: 8px; border-radius: 6px">
            <option value="all">T·∫•t c·∫£</option>
            <option value="pending">Pending</option>
            <option value="approved">Approved</option>
            <option value="rejected">Rejected</option>
          </select>
          <button
            id="refreshReviews"
            style="
              padding: 8px 12px;
              background: #004b9a;
              color: #fff;
              border: none;
              border-radius: 6px;
              cursor: pointer;
            "
          >
            L√†m m·ªõi
          </button>
          <label for="searchInput" style="margin-left: 8px">T√¨m ki·∫øm:</label>
          <input
            id="searchInput"
            type="search"
            placeholder="T√™n, n·ªôi dung, chuy·∫øn"
            style="
              padding: 8px;
              border-radius: 6px;
              border: 1px solid #ccc;
              min-width: 200px;
            "
          />
          <label for="pageSize">Hi·ªÉn th·ªã:</label>
          <select id="pageSize" style="padding: 8px; border-radius: 6px">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
        </div>

        <div id="adminFeedbackList" class="feedback-list"></div>
        <div
          id="pagination"
          style="margin-top: 16px; display: flex; gap: 8px; align-items: center"
        ></div>
      </section>
    </main>

    <!-- Admin chat widget (conversations) -->
    <div
      class="admin-chat-widget"
      style="position: fixed; right: 20px; bottom: 20px; z-index: 9999"
    >
      <button
        id="adminChatToggle"
        aria-label="M·ªü qu·∫£n l√Ω chat"
        style="
          width: 56px;
          height: 56px;
          border-radius: 50%;
          background: #00532c;
          color: #fff;
          border: none;
          cursor: pointer;
          font-size: 20px;
        "
      >
        üí¨
      </button>

      <div
        id="adminChatWindow"
        class="chat-window"
        role="dialog"
        aria-label="H·ªôp tho·∫°i chat doanh nghi·ªáp"
        style="
          display: none;
          width: 320px;
          height: 420px;
          background: #fff;
          border: 1px solid #ddd;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.16);
          border-radius: 8px;
          overflow: hidden;
          margin-bottom: 12px;
          position: relative;
          display: flex;
          flex-direction: column;
        "
      >
        <!-- compact chat-like header (keeps convoSearch & refresh) -->
        <div
          class="chat-header"
          style="
            display: block;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #f5f7fb;
            border-bottom: 1px solid #eee;
          "
        >
          <div style="display: flex; flex-direction: column">
            <strong style="font-size: 14px">H·ªó tr·ª£ - Doanh nghi·ªáp</strong>
            <div
              id="convoHeader"
              style="font-size: 12px; color: #666; margin-top: 4px"
            >
              Ch∆∞a ch·ªçn cu·ªôc h·ªôi tho·∫°i
            </div>
          </div>
          <div style="display: flex; gap: 6px; align-items: center">
            <input
              id="convoSearch"
              placeholder="T√¨m email..."
              style="
                padding: 6px 8px;
                border-radius: 6px;
                border: 1px solid #ccc;
                min-width: 120px;
              "
            />
            <button
              id="refreshConvos"
              title="L√†m m·ªõi"
              style="
                padding: 6px 8px;
                border-radius: 6px;
                border: none;
                background: #eee;
              "
            >
              ‚ü≥
            </button>
            <button
              id="openConvoList"
              title="Danh s√°ch"
              style="
                padding: 6px 8px;
                border-radius: 6px;
                border: none;
                background: #eee;
              "
            >
              ‚ò∞
            </button>
          </div>
        </div>

        <button
          id="chatCloseAdmin"
          aria-label="ƒê√≥ng"
          style="
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 6px 8px;
            border-radius: 6px;
            border: none;
            background: transparent;
            font-size: 16px;
            z-index: 1;
          "
        >
          &times;
        </button>

        <!-- messages area (main) -->
        <div class="chat-messages" id="convoMessages" aria-live="polite"></div>

        <!-- input area -->
        <div
          class="chat-input"
          style="
            padding: 8px;
            border-top: 1px solid #f1f1f1;
            display: flex;
            gap: 8px;
          "
        >
          <input
            id="convoReplyInput"
            placeholder="G√µ tin nh·∫Øn..."
            style="
              flex: 1;
              padding: 8px;
              border-radius: 6px;
              border: 1px solid #ccc;
            "
          />
          <button
            id="convoReplySend"
            style="
              padding: 8px 12px;
              border-radius: 6px;
              border: none;
              background: #00532c;
              color: #fff;
            "
          >
            G·ª≠i
          </button>
        </div>

        <!-- hidden slide-out list (keeps original convoListItems content) -->
        <div
          id="convoListItems"
          style="
            display: none;
            position: absolute;
            bottom: 64px;
            width: 320px;
            height: 360px;
            overflow: auto;
            border: 1px solid #eee;
            background: #fff;
            border-radius: 6px;
            padding: 12px 12px 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            z-index: 10000;
          "
        ></div>
      </div>
    </div>

    <script>
      // toggle admin chat window and compact conversation list
      (function () {
        const btn = document.getElementById("adminChatToggle");
        const win = document.getElementById("adminChatWindow");
        const listBox = document.getElementById("convoListItems");
        const openList = document.getElementById("openConvoList");
        const closeBtn = document.getElementById("chatCloseAdmin");
        const closeIfNeeded = (e) => {
          if (!win || !btn) return;
          if (!win.contains(e.target) && e.target !== btn)
            win.style.display = "none";
          if (listBox) listBox.style.display = "none";
        };

        if (btn)
          btn.addEventListener("click", () => {
            if (!win) return;
            const willOpen = !(
              win.style.display === "flex" || win.style.display === "block"
            );
            win.style.display = willOpen ? "flex" : "none";
            if (willOpen) {
              try {
                if (
                  window._adminFeedback &&
                  typeof window._adminFeedback.renderConversationsList ===
                    "function"
                ) {
                  window._adminFeedback.renderConversationsList();
                }
                const s = document.getElementById("convoSearch");
                if (s) s.focus();
              } catch (e) {}
            } else {
              if (listBox) listBox.style.display = "none";
            }
          });

        // open/hide convo list (overlay)
        if (openList && listBox) {
          openList.addEventListener("click", (e) => {
            e.stopPropagation();
            listBox.style.display =
              listBox.style.display === "block" ? "none" : "block";
            if (listBox.style.display === "block") {
              try {
                if (
                  window._adminFeedback &&
                  typeof window._adminFeedback.renderConversationsList ===
                    "function"
                )
                  window._adminFeedback.renderConversationsList();
              } catch (e) {}
            }
          });
        }

        // close internal close button
        if (closeBtn)
          closeBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            if (win) win.style.display = "none";
            if (listBox) listBox.style.display = "none";
          });

        document.addEventListener("click", closeIfNeeded);
      })();
    </script>

    <!-- Footer (from business.html) -->
    <footer class="footer-business">
      <div class="footer-container">
        <div class="footer-about">
          <h2>BookNow Business</h2>
          <p>
            N·ªÅn t·∫£ng k·∫øt n·ªëi doanh nghi·ªáp v√† kh√°ch h√†ng nhanh ch√≥ng, h·ªó tr·ª£ ƒë·∫∑t
            v√©, v√† qu·∫£n l√Ω d·ªãch v·ª• d·ªÖ d√†ng tr√™n c√πng m·ªôt h·ªá th·ªëng.
          </p>
        </div>

        <div class="footer-contact">
          <h3>Li√™n h·ªá</h3>
          <nav>
            <ul>
              <li><a href="https://www.facebook.com/BookNow">Facebook</a></li>
              <li><a href="https://www.twitter.com/BookNow">Twitter</a></li>
              <li><a href="https://www.instagram.com/BookNow">Instagram</a></li>
              <li><a href="mailto:q2u6a0n1g@gmail.com">Gmail</a></li>
            </ul>
          </nav>
        </div>
      </div>

      <div class="footer-bottom">
        <p>¬© 2025 BookNow Business. All rights reserved.</p>
      </div>
    </footer>

    <script src="js/business.js"></script>
    <script src="js/danhgia.js"></script>
  </body>
</html>
