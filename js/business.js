// ==============================================
// üîπ Hi·ªáu ·ª©ng khi cu·ªôn xu·ªëng ph·∫ßn "D·ªãch v·ª•"
// ==============================================
window.addEventListener("scroll", () => {
  const services = document.querySelector(".services");
  if (!services) return;

  const position = services.getBoundingClientRect().top;
  const screenHeight = window.innerHeight;

  if (position < screenHeight - 100) {
    services.classList.add("visible");
  }
});

// ==============================================
// üîπ X·ª≠ l√Ω hi·ªÉn th·ªã ƒëƒÉng nh·∫≠p / ƒëƒÉng xu·∫•t ·ªü header
// ==============================================
document.addEventListener("DOMContentLoaded", () => {
  const authBtns = document.querySelector(".auth-btns");
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));

  if (authBtns) {
    if (currentUser && currentUser.name) {
      authBtns.innerHTML = `
        <span class="welcome">Xin ch√†o, <b>${currentUser.name}</b></span>
        <button class="logout-btn">ƒêƒÉng xu·∫•t</button>
      `;
      document.querySelector(".logout-btn").addEventListener("click", () => {
        localStorage.removeItem("currentUser");
        location.reload();
      });
    } else {
      authBtns.innerHTML = `
        <button class="login-btn">ƒêƒÉng nh·∫≠p</button>
        <button class="signup-btn">ƒêƒÉng k√Ω</button>
      `;
      document.querySelector(".login-btn").addEventListener("click", () => {
        window.location.href = "dangnhap.html";
      });
      document.querySelector(".signup-btn").addEventListener("click", () => {
        window.location.href = "dangnhap.html";
      });
    }
  }
});

// ==============================================
// üîπ Cu·ªôn m∆∞·ª£t khi b·∫•m link trong header/footer
// ==============================================
document.addEventListener("DOMContentLoaded", () => {
  const navLinks = document.querySelectorAll("header nav a, .footer-links a");
  navLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      const targetId = link.getAttribute("href");
      if (targetId.startsWith("#")) {
        e.preventDefault();
        document.querySelector(targetId).scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
        navLinks.forEach((l) => l.classList.remove("active"));
        link.classList.add("active");
      }
    });
  });
});

// ==============================================
// üîπ X·ª≠ l√Ω hi·ªÉn th·ªã c√°c tab d·ªãch v·ª•
// ==============================================
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = document.querySelectorAll(".tab-btn");
  const forms = document.querySelectorAll(".service-form");

  tabButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      tabButtons.forEach((b) => b.classList.remove("active"));
      forms.forEach((f) => f.classList.add("hidden"));
      btn.classList.add("active");
      const targetForm = document.getElementById(`form-${btn.dataset.tab}`);
      if (targetForm) targetForm.classList.remove("hidden");
    });
  });
});

// =============================
// üîπ X·ª≠ l√Ω ·∫£nh xem tr∆∞·ªõc
// =============================
const inputAnh = document.getElementById("anhPhim");
const preview = document.getElementById("previewPhim");
let base64Anh = "";

if (inputAnh) {
  inputAnh.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      base64Anh = e.target.result;
      if (file.type.startsWith("video/")) {
        preview.innerHTML = `<video controls src="${base64Anh}"></video>`;
      } else {
        preview.innerHTML = `<img src="${base64Anh}" alt="Preview">`;
      }
    };
    reader.readAsDataURL(file);
  });
}

// =============================
// üîπ Th√™m phim + l∆∞u v√†o localStorage
// =============================
const form = document.getElementById("addPhimForm");
if (form) {
  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const ten = document.getElementById("tenPhim").value.trim();
    const moTa = document.getElementById("moTaPhim").value.trim();
    const gia = document.getElementById("giaVePhim").value.trim();
    const suat = document.getElementById("suatChieuPhim").value.trim();
    const rap = document.getElementById("rapPhim").value.trim();
    const fileInput = document.getElementById("anhPhim");

    if (!ten || !moTa || !gia) {
      alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    const reader = new FileReader();
    reader.onload = function () {
      const anh = reader.result || "";
      const phim = { ten, moTa, gia, suat, rap, anh };
      let dsPhim = JSON.parse(localStorage.getItem("danhSachPhim")) || [];
      dsPhim.push(phim);
      localStorage.setItem("danhSachPhim", JSON.stringify(dsPhim));

      hienThiPhim(phim, dsPhim.length - 1);
      e.target.reset(); // ‚úÖ Xo√° tr·∫Øng input
      preview.innerHTML = ""; // ‚úÖ Xo√° ·∫£nh xem tr∆∞·ªõc
      alert("‚úÖ ƒê√£ th√™m phim th√†nh c√¥ng!");
    };

    if (fileInput.files[0]) {
      reader.readAsDataURL(fileInput.files[0]);
    } else {
      const phim = { ten, moTa, gia, suat, rap, anh: "" };
      let dsPhim = JSON.parse(localStorage.getItem("danhSachPhim")) || [];
      dsPhim.push(phim);
      localStorage.setItem("danhSachPhim", JSON.stringify(dsPhim));
      hienThiPhim(phim, dsPhim.length - 1);
      e.target.reset();
      preview.innerHTML = "";
      alert("‚úÖ ƒê√£ th√™m phim th√†nh c√¥ng!");
    }
  });
}

// ===== HI·ªÇN TH·ªä DANH S√ÅCH PHIM =====
document.addEventListener("DOMContentLoaded", () => {
  const dsPhim = JSON.parse(localStorage.getItem("danhSachPhim")) || [];
  dsPhim.forEach((phim, index) => hienThiPhim(phim, index));
});

function hienThiPhim(phim, index) {
  const list = document.getElementById("addedPhimList");
  if (!list) return;

  const placeholder = list.querySelector(".placeholder");
  if (placeholder) placeholder.remove();

  const item = document.createElement("div");
  item.classList.add("movie-card");
  item.innerHTML = `
    <button class="delete-btn" title="Xo√° phim">√ó</button>
    <img src="${phim.anh || "images/default-poster.jpg"}" alt="${phim.ten}" class="movie-poster">
    <div class="movie-info">
      <h3 class="movie-title">${phim.ten}</h3>
      <p>üé¨ ${phim.moTa}</p>
      <p>üí∏ ${phim.gia} VNƒê</p>
      <p>‚è∞ ${phim.suat || "Kh√¥ng c√≥"}</p>
      <p>üìç ${phim.rap || "Kh√¥ng c√≥"}</p>
    </div>
  `;

  // Xo√° phim
  item.querySelector(".delete-btn").addEventListener("click", (e) => {
    e.stopPropagation();
    if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën xo√° "${phim.ten}" kh√¥ng?`)) {
      let dsPhim = JSON.parse(localStorage.getItem("danhSachPhim")) || [];
      dsPhim.splice(index, 1);
      localStorage.setItem("danhSachPhim", JSON.stringify(dsPhim));
      item.remove();

      // N·∫øu xo√° h·∫øt -> hi·ªÉn th·ªã placeholder
      if (dsPhim.length === 0) {
        list.innerHTML = `<p class="placeholder" style="font-style: italic; color: #888;">Ch∆∞a c√≥ d·ªãch v·ª• n√†o ƒë∆∞·ª£c th√™m.</p>`;
      }
    }
  });

  // Xem chi ti·∫øt popup
  item.addEventListener("click", () => showPopup(phim));

  list.appendChild(item);
}

// ===== POPUP XEM CHI TI·∫æT =====
function showPopup(phim) {
  const popup = document.getElementById("moviePopup");
  if (!popup) return;

  document.getElementById("popupImage").src = phim.anh || "images/default-poster.jpg";
  document.getElementById("popupTitle").textContent = phim.ten;
  document.getElementById("popupDesc").textContent = "üé¨ " + phim.moTa;
  document.getElementById("popupGia").textContent = "üí∏ " + phim.gia + " VNƒê";
  document.getElementById("popupSuat").textContent = "‚è∞ " + (phim.suat || "Kh√¥ng c√≥");
  document.getElementById("popupRap").textContent = "üìç " + (phim.rap || "Kh√¥ng c√≥");

  popup.style.display = "flex";

  popup.querySelector(".close-btn").onclick = () => (popup.style.display = "none");
  popup.onclick = (e) => {
    if (e.target === popup) popup.style.display = "none";
  };
}

document.addEventListener("DOMContentLoaded", () => {
  // === C√°c ph·∫ßn t·ª≠ n√∫t tab ===
  const tabButtons = document.querySelectorAll(".tab-btn");

  // === C√°c form & danh s√°ch ===
  const sections = {
    phim: ["form-phim", "list-phim"],
    phuongtien: ["form-phuongtien", "list-phuongtien"],
    khachsan: ["form-khachsan", "list-khachsan"]
  };

  // === X·ª≠ l√Ω chuy·ªÉn tab ===
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      // B·ªè active ·ªü t·∫•t c·∫£
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // ·∫®n to√†n b·ªô form/danh s√°ch
      Object.values(sections).flat().forEach(id => {
        document.getElementById(id).classList.add("hidden");
      });

      // Hi·ªán ƒë√∫ng lo·∫°i d·ªãch v·ª•
      const tab = btn.dataset.tab;
      sections[tab].forEach(id => {
        document.getElementById(id).classList.remove("hidden");
      });
    });
  });

  // ===================================================
  // ==================== PHIM ==========================
  // ===================================================
  const addPhimForm = document.getElementById("addPhimForm");
  const addedPhimList = document.getElementById("addedPhimList");

  addPhimForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const tenPhim = document.getElementById("tenPhim").value;
    const moTaPhim = document.getElementById("moTaPhim").value;
    const giaVePhim = document.getElementById("giaVePhim").value;

    const div = document.createElement("div");
    div.classList.add("added-item");
    div.textContent = `${tenPhim} - ${giaVePhim} VNƒê`;
    addedPhimList.appendChild(div);

    addPhimForm.reset();
  });

  // ===================================================
  // ================== PH∆Ø∆†NG TI·ªÜN ====================
  // ===================================================
  const addPhuongTienForm = document.getElementById("addPhuongTienForm");
  const addedPhuongTienList = document.getElementById("addedPhuongTienList");

  addPhuongTienForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const loai = document.getElementById("loaiPhuongTien").value;
    const diemDon = document.getElementById("diemDon").value;
    const diemDen = document.getElementById("diemDen").value;
    const gia = document.getElementById("giaVePhuongTien").value;

    const div = document.createElement("div");
    div.classList.add("added-item");
    div.textContent = `${loai} | ${diemDon} ‚Üí ${diemDen} | ${gia} VNƒê`;
    addedPhuongTienList.appendChild(div);

    addPhuongTienForm.reset();
  });

  // ===================================================
  // ==================== KH√ÅCH S·∫†N ====================
  // ===================================================
  const addKhachSanForm = document.getElementById("addKhachSanForm");
  const addedKhachSanList = document.getElementById("addedKhachSanList");

  addKhachSanForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const ten = document.getElementById("tenKhachSan").value;
    const soPhong = document.getElementById("soPhong").value;
    const gia = document.getElementById("giaPhong").value;

    const div = document.createElement("div");
    div.classList.add("added-item");
    div.textContent = `${ten} - ${soPhong} ph√≤ng - ${gia} VNƒê/ƒë√™m`;
    addedKhachSanList.appendChild(div);

    addKhachSanForm.reset();
  });
});

// =============================
// üîπ PHIM (ƒê√É C√ì S·∫¥N, GI·ªÆ NGUY√äN)
// =============================
// ... ph·∫ßn code phim c·ªßa b·∫°n ·ªü tr√™n ...

// ======================================================================
// üîπ PH∆Ø∆†NG TI·ªÜN
// ======================================================================

// === ·∫¢NH XEM TR∆Ø·ªöC ===
const inputAnhPT = document.getElementById("anhPhuongTien");
const previewPT = document.getElementById("previewPhuongTien");
let base64AnhPT = "";

if (inputAnhPT) {
  inputAnhPT.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      base64AnhPT = e.target.result;
      if (file.type.startsWith("video/")) {
        previewPT.innerHTML = `<video controls src="${base64AnhPT}"></video>`;
      } else {
        previewPT.innerHTML = `<img src="${base64AnhPT}" alt="Preview">`;
      }
    };
    reader.readAsDataURL(file);
  });
}

// === TH√äM PH∆Ø∆†NG TI·ªÜN ===
const formPT = document.getElementById("addPhuongTienForm");
if (formPT) {
  formPT.addEventListener("submit", function (e) {
    e.preventDefault();

    const loai = document.getElementById("loaiPhuongTien").value.trim();
    const diemDon = document.getElementById("diemDon").value.trim();
    const diemDen = document.getElementById("diemDen").value.trim();
    const gioKhoiHanh = document.getElementById("gioKhoiHanh").value;
    const gia = document.getElementById("giaVePhuongTien").value.trim();

    if (!loai || !diemDon || !diemDen || !gioKhoiHanh || !gia) {
      alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    const phuongTien = {
      loai,
      diemDon,
      diemDen,
      gioKhoiHanh,
      gia,
      anh: base64AnhPT || ""
    };

    let dsPT = JSON.parse(localStorage.getItem("danhSachPhuongTien")) || [];
    dsPT.push(phuongTien);
    localStorage.setItem("danhSachPhuongTien", JSON.stringify(dsPT));

    hienThiPhuongTien(phuongTien, dsPT.length - 1);
    e.target.reset();
    previewPT.innerHTML = "";
    alert("‚úÖ ƒê√£ th√™m ph∆∞∆°ng ti·ªán th√†nh c√¥ng!");
  });
}

// === HI·ªÇN TH·ªä DANH S√ÅCH ===
document.addEventListener("DOMContentLoaded", () => {
  const dsPT = JSON.parse(localStorage.getItem("danhSachPhuongTien")) || [];
  dsPT.forEach((pt, index) => hienThiPhuongTien(pt, index));
});

function hienThiPhuongTien(pt, index) {
  const list = document.getElementById("addedPhuongTienList");
  if (!list) return;

  const placeholder = list.querySelector(".placeholder");
  if (placeholder) placeholder.remove();

  const item = document.createElement("div");
  item.classList.add("vehicle-card");
  item.innerHTML = `
    <button class="delete-btn" title="Xo√° ph∆∞∆°ng ti·ªán">√ó</button>
    <img src="${pt.anh || 'images/default-vehicle.jpg'}" alt="${pt.loai}" class="vehicle-img">
    <div class="vehicle-info">
      <h3>${pt.loai}</h3>
      <p>üöè ${pt.diemDon} ‚Üí ${pt.diemDen}</p>
      <p>üïí ${pt.gioKhoiHanh}</p>
      <p>üí∏ ${pt.gia} VNƒê</p>
    </div>
  `;

  // Xo√° ph∆∞∆°ng ti·ªán
  item.querySelector(".delete-btn").addEventListener("click", (e) => {
    e.stopPropagation();
    if (confirm(`Xo√° ph∆∞∆°ng ti·ªán "${pt.loai}"?`)) {
      let dsPT = JSON.parse(localStorage.getItem("danhSachPhuongTien")) || [];
      dsPT.splice(index, 1);
      localStorage.setItem("danhSachPhuongTien", JSON.stringify(dsPT));
      item.remove();
    }
  });

  // Xem chi ti·∫øt popup
  item.addEventListener("click", () => showVehiclePopup(pt));

  list.appendChild(item);
}

// === POPUP PH∆Ø∆†NG TI·ªÜN ===
function showVehiclePopup(pt) {
  const popup = document.getElementById("popupVehicleImage").closest(".popup");
  if (!popup) return;

  document.getElementById("popupVehicleImage").src = pt.anh || "images/default-vehicle.jpg";
  document.getElementById("popupVehicleLoai").textContent = pt.loai;
  document.getElementById("popupVehicleRoute").textContent = `üöè ${pt.diemDon} ‚Üí ${pt.diemDen}`;
  document.getElementById("popupVehicleGia").textContent = `üí∏ ${pt.gia} VNƒê`;

  popup.style.display = "flex";
  popup.querySelector(".close-btn").onclick = () => (popup.style.display = "none");
  popup.onclick = (e) => {
    if (e.target === popup) popup.style.display = "none";
  };
}

// ======================================================================
// üîπ KH√ÅCH S·∫†N
// ======================================================================

// === ·∫¢NH XEM TR∆Ø·ªöC ===
const inputAnhKS = document.getElementById("anhKhachSan");
const previewKS = document.getElementById("previewKhachSan");
let base64AnhKS = "";

if (inputAnhKS) {
  inputAnhKS.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      base64AnhKS = e.target.result;
      if (file.type.startsWith("video/")) {
        previewKS.innerHTML = `<video controls src="${base64AnhKS}"></video>`;
      } else {
        previewKS.innerHTML = `<img src="${base64AnhKS}" alt="Preview">`;
      }
    };
    reader.readAsDataURL(file);
  });
}

// === TH√äM KH√ÅCH S·∫†N ===
const formKS = document.getElementById("addKhachSanForm");
if (formKS) {
  formKS.addEventListener("submit", function (e) {
    e.preventDefault();

    const ten = document.getElementById("tenKhachSan").value.trim();
    const moTa = document.getElementById("moTaKhachSan").value.trim();
    const soPhong = document.getElementById("soPhong").value.trim();
    const gia = document.getElementById("giaPhong").value.trim();

    if (!ten || !moTa || !soPhong || !gia) {
      alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    const khachSan = {
      ten,
      moTa,
      soPhong,
      gia,
      anh: base64AnhKS || ""
    };

    let dsKS = JSON.parse(localStorage.getItem("danhSachKhachSan")) || [];
    dsKS.push(khachSan);
    localStorage.setItem("danhSachKhachSan", JSON.stringify(dsKS));

    hienThiKhachSan(khachSan, dsKS.length - 1);
    e.target.reset();
    previewKS.innerHTML = "";
    alert("‚úÖ ƒê√£ th√™m kh√°ch s·∫°n th√†nh c√¥ng!");
  });
}

// === HI·ªÇN TH·ªä DANH S√ÅCH ===
document.addEventListener("DOMContentLoaded", () => {
  const dsKS = JSON.parse(localStorage.getItem("danhSachKhachSan")) || [];
  dsKS.forEach((ks, index) => hienThiKhachSan(ks, index));
});

function hienThiKhachSan(ks, index) {
  const list = document.getElementById("addedKhachSanList");
  if (!list) return;

  const placeholder = list.querySelector(".placeholder");
  if (placeholder) placeholder.remove();

  const item = document.createElement("div");
  item.classList.add("hotel-card");
  item.innerHTML = `
    <button class="delete-btn" title="Xo√° kh√°ch s·∫°n">√ó</button>
    <img src="${ks.anh || 'images/default-hotel.jpg'}" alt="${ks.ten}" class="hotel-img">
    <div class="hotel-info">
      <h3>${ks.ten}</h3>
      <p>üõèÔ∏è ${ks.moTa}</p>
      <p>üè† S·ªë ph√≤ng: ${ks.soPhong}</p>
      <p>üí∏ ${ks.gia} VNƒê/ƒë√™m</p>
    </div>
  `;

  // Xo√° kh√°ch s·∫°n
  item.querySelector(".delete-btn").addEventListener("click", (e) => {
    e.stopPropagation();
    if (confirm(`Xo√° kh√°ch s·∫°n "${ks.ten}"?`)) {
      let dsKS = JSON.parse(localStorage.getItem("danhSachKhachSan")) || [];
      dsKS.splice(index, 1);
      localStorage.setItem("danhSachKhachSan", JSON.stringify(dsKS));
      item.remove();
    }
  });

  // Xem chi ti·∫øt popup
  item.addEventListener("click", () => showHotelPopup(ks));

  list.appendChild(item);
}

// === POPUP KH√ÅCH S·∫†N ===
function showHotelPopup(ks) {
  const popup = document.getElementById("popupHotelTen").closest(".popup");
  if (!popup) return;
  document.getElementById("popupHotelImage").src = ks.anh || "images/default-hotel.jpg";
  document.getElementById("popupHotelTen").textContent = ks.ten;
  document.getElementById("popupHotelMoTa").textContent = "üõèÔ∏è " + ks.moTa;
  document.getElementById("popupHotelSoPhong").textContent = "üè† S·ªë ph√≤ng: " + ks.soPhong;
  document.getElementById("popupHotelGia").textContent = "üí∏ " + ks.gia + " VNƒê/ƒë√™m";

  popup.style.display = "flex";
  popup.querySelector(".close-btn").onclick = () => (popup.style.display = "none");
  popup.onclick = (e) => {
    if (e.target === popup) popup.style.display = "none";
  };
}
